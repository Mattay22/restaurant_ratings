<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scotland's Food Hygiene Dashboards</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

  <!-- Load jQuery before DataTables -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

  <!-- Google Ads -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2161892029432471"
    crossorigin="anonymous"></script>
</head>

<body>
  <div class="banner">
    New Regions Available Soon
  </div>

  <header>
    <h1>Food Hygiene Dashboard</h1>
    <nav>
      <a href="/">Home</a>
      <a href="/postcode-summary">Postcode Analyser</a>
      <a href="/postcode-rankings">Postcode Rankings</a>
    </nav>
  </header>

  <h2>Postcode Hygiene Rankings</h2>
  <div class="centered-filter">
    <label for="minTotal">Minimum restaurants per postcode:</label>
    <input type="number" id="minTotal" value="10" min="0" style="width: 80px;">
  </div>
  
  
  <table class="table table-bordered table-striped table-hover text-center align-middle">
    <thead class="table-dark">
      <tr>
        <th>Postcode</th>
        <th>Total</th>
        <th>% Passed</th>
        <th>% Failed</th>
        <th>% Awaiting Inspection</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rankings %}
      <tr class="{% if r.percent_passed >= 90 %}table-success{% elif r.percent_failed >= 50 %}table-danger{% endif %}">
        <td>
          <a href="https://www.google.com/maps/place/Glasgow+{{ r.postcode | urlencode }}/" target="_blank" rel="noopener noreferrer" class="white-link">
            {{ r.postcode }}
          </a>
        </td>
        <td>{{ r.total }}</td>
        <td>{{ r.percent_passed }}%</td>
        <td>{{ r.percent_failed }}%</td>
        <td>{{ r.percent_awaiting_inspection }}%</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <script>
    $(document).ready(function () {
      const table = $('.table').DataTable({
        order: [[0, 'asc']],       // Sort by postcode
        paging: false,             // Show all rows, no pagination
        info: false,               // Hide "Showing X of Y entries"
        lengthChange: false        // Remove "Show entries" dropdown
      });
  
      // Custom filter function
      $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
        const minTotal = parseInt($('#minTotal').val(), 10) || 0;
        const total = parseInt(data[1], 10); // Column index 1 = "Total"
  
        return total > minTotal;
      });
  
      // Trigger filter on input change
      $('#minTotal').on('input', function () {
        table.draw();
      });
    });
  </script>
  
  
</body>
</html>
